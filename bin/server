#!/bin/sh

NR_NODES=$1
shift

S_ADDRESS="-Dibis.server.address=fs0.das3.cs.vu.nl-7777"
POOL_NAME="-Dibis.pool.name=ibisDist"
POOL_SIZE="-Dibis.pool.size=$NR_NODES"
PROG_NAME=ibis.mbf.server.Server

for i in external/ibis/*.jar
do
    CP=$CP:$i
done

for i in jars/*.jar
do
    CP=$CP:$i
done

NORMAL=
SPECIAL=

while [ $# -gt 0 ]
do

        HEADER=`echo $1 | head --bytes=2`

        case "$HEADER" in
        -D)
                SPECIAL="$SPECIAL $1"
                ;;
        *)
                NORMAL="$NORMAL $1"
                ;;
        esac
        shift
done

echo prun -1 -no-panda java $NR_NODES -cp $CP -Dlog4j.configuration=file:`pwd`/log4j.properties $SPECIAL $S_ADDRESS $POOL_NAME $POOL_SIZE $PROG_NAME $NORMAL
prun -1 -no-panda java $NR_NODES -cp $CP -Dlog4j.configuration=file:`pwd`/log4j.properties $SPECIAL $S_ADDRESS $POOL_NAME $POOL_SIZE $PROG_NAME $NORMAL


